{% extends 'base.html' %}
{% block content %}
<article class="bg-gray-800 p-6 rounded-lg shadow-lg mb-6">
  <h1 class="text-2xl font-bold text-white">{{ res.title }}</h1>
  <p class="text-gray-400">
    Subject: <strong>{{ res.subject or '—' }}</strong> |
    Author: <strong>{{ res.author or '—' }}</strong> |
    Uploaded: {{ res.uploaded_at.strftime('%Y-%m-%d %H:%M') }}
  </p>
  <p class="text-white mt-4">{{ res.description or '' }}</p>
  <p class="mt-4">
    <a class="btn px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-400"
      href="{{ url_for('download', resource_id=res.id) }}">Download</a>
    {% if res.uploader_id == current_user.id %}
  <form action="{{ url_for('resource_delete', resource_id=res.id) }}" method="post" class="inline-block">
    <button class="btn px-4 py-2 bg-red-500 text-white rounded hover:bg-red-400"
      onclick="return confirm('Delete this file?')">Delete</button>
  </form>
  {% endif %}
  </p>
</article>

<section class="bg-gray-800 p-6 rounded-lg shadow-lg">
  <h2 class="text-xl font-bold text-white">Rate this resource</h2>
  <form method="post" action="{{ url_for('submit_review', resource_id=res.id) }}">
    <div class="stars mb-4" data-initial="{{ (res.avg_rating or 0)|int }}"></div>
    <input type="hidden" name="rating" id="rating-input" value="">
    <label class="text-white block mt-2">Comment (optional)
      <textarea name="comment" rows="3" class="w-full p-2 rounded bg-gray-700 text-white mt-2"></textarea>
    </label>
    <button type="submit" class="btn px-4 py-2 bg-green-500 text-white rounded hover:bg-green-400 mt-4">Submit
      Review</button>
  </form>
  <p class="text-gray-400 mt-4">Average rating: {{ res.avg_rating or '—' }}/10</p>
  <ul class="list-none mt-4">
    {% for rev in res.reviews|sort(attribute='created_at', reverse=true) %}
    <li class="text-white mb-2"><strong>{{ rev.rating }}/10</strong> — {{ rev.comment or '' }} <span
        class="text-gray-400">by {{ rev.reviewer.username }} on {{ rev.created_at.strftime('%Y-%m-%d') }}</span></li>
    {% else %}
    <li class="text-gray-400">No reviews yet.</li>
    {% endfor %}
  </ul>
</section>
{% endblock %}